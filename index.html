<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KLEE Lab Secure Upload</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <!-- Hero Section -->
    <section class="bg-dark text-white py-5">
        <div class="container text-center">
            <h1 class="display-4">KLEE Lab 온라인 파일 확인 시스템</h1>
            <p class="lead">물리적 하드가 필요 없는 시스템을 위해</p>
        </div>
    </section>

    <!-- Cards Section -->
    <div class="container my-5">
        <div class="row">
            <!-- Card 1 -->
            <div class="col-md-4">
                <div class="card">
                    <img src="https://via.placeholder.com/150" class="card-img-top" alt="Uploaded Image" id="cardImage1">
                    <div class="card-body">
                        <h5 class="card-title">Fiber photometry TASK</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Edited 2024.12.17</h6>
                        <p class="card-text">Fiber photometry 실험 task 확인 가능!</p>
                        <!-- Password Input Section -->
                        <div id="passwordSection1">
                            <input type="password" id="password1" class="form-control mb-2" placeholder="비밀번호 입력">
                            <button class="btn btn-secondary" onclick="checkPassword('password1', 'passwordSection1', 'uploadSection1')">비밀번호 확인</button>
                        </div>
                        <!-- File Upload Section -->
                        <div id="uploadSection1" style="display: none;">
                            <input type="file" class="form-control mb-3" id="fileInput1" accept="*/*">
                            <button class="btn btn-primary" onclick="uploadFile('fileInput1', 'uploads', 'cardImage1')">파일 업로드</button>
                            <a href="#" id="fileLink1" class="btn btn-success mt-2" style="display: none;">업로드된 파일 열기</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Repeat for additional cards -->
            <!-- Card 2 -->
            <div class="col-md-4">
                <div class="card">
                    <img src="https://via.placeholder.com/150" class="card-img-top" alt="Uploaded Image" id="cardImage2">
                    <div class="card-body">
                        <h5 class="card-title">Fiber photometry TASK</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Edited 2024.12.17</h6>
                        <p class="card-text">Fiber photometry 실험 task 확인 가능!</p>
                        <div id="passwordSection2">
                            <input type="password" id="password2" class="form-control mb-2" placeholder="비밀번호 입력">
                            <button class="btn btn-secondary" onclick="checkPassword('password2', 'passwordSection2', 'uploadSection2')">비밀번호 확인</button>
                        </div>
                        <div id="uploadSection2" style="display: none;">
                            <input type="file" class="form-control mb-3" id="fileInput2" accept="*/*">
                            <button class="btn btn-primary" onclick="uploadFile('fileInput2', 'uploads', 'cardImage2')">파일 업로드</button>
                            <a href="#" id="fileLink2" class="btn btn-success mt-2" style="display: none;">업로드된 파일 열기</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="col-md-4">
                <div class="card">
                    <img src="https://via.placeholder.com/150" class="card-img-top" alt="Uploaded Image" id="cardImage3">
                    <div class="card-body">
                        <h5 class="card-title">Fiber photometry TASK</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Edited 2024.12.17</h6>
                        <p class="card-text">Fiber photometry 실험 task 확인 가능!</p>
                        <div id="passwordSection3">
                            <input type="password" id="password3" class="form-control mb-2" placeholder="비밀번호 입력">
                            <button class="btn btn-secondary" onclick="checkPassword('password3', 'passwordSection3', 'uploadSection3')">비밀번호 확인</button>
                        </div>
                        <div id="uploadSection3" style="display: none;">
                            <input type="file" class="form-control mb-3" id="fileInput3" accept="*/*">
                            <button class="btn btn-primary" onclick="uploadFile('fileInput3', 'uploads', 'cardImage3')">파일 업로드</button>
                            <a href="#" id="fileLink3" class="btn btn-success mt-2" style="display: none;">업로드된 파일 열기</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Password Protection and Supabase File Upload -->
    <script>
        // Set a predefined password
        const correctPassword = "1234"; // Replace with your actual password

        // Initialize Supabase
        const supabase = supabase.createClient('https://wvcqeoeevueslyjmtfdw.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind2Y3Flb2VldnVlc2x5am10ZmR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ0OTgyODMsImV4cCI6MjA1MDA3NDI4M30.k7f8JTIV7P7N2k3D5WmJPlWUZbzzibS9s9hFK_xG_U8EY');

        // Function to check the password
        function checkPassword(passwordFieldId, passwordSectionId, uploadSectionId) {
            const passwordField = document.getElementById(passwordFieldId);
            const passwordSection = document.getElementById(passwordSectionId);
            const uploadSection = document.getElementById(uploadSectionId);
            if (passwordField.value === correctPassword) {
                alert("비밀번호가 확인되었습니다.");
                passwordSection.style.display = "none"; // Hide password input
                uploadSection.style.display = "block"; // Show upload section
            } else {
                alert("비밀번호가 틀렸습니다.");
            }
        }

        // Function to upload file to Supabase Storage
        async function uploadFile(fileInputId, bucketName, cardImageId) {
            const fileInput = document.getElementById(fileInputId);
            const file = fileInput.files[0];
            const fileLink = document.getElementById(`fileLink${fileInputId.slice(-1)}`);

            if (!file) {
                alert('파일을 선택해주세요.');
                return;
            }

            const { data, error } = await supabase.storage.from(bucketName).upload(file.name, file);

            if (error) {
                alert('업로드 실패: ' + error.message);
                return;
            }

            const { publicURL } = supabase.storage.from(bucketName).getPublicUrl(file.name);

            if (file.type.startsWith('image/')) {
                document.getElementById(cardImageId).src = publicURL;
            }

            fileLink.href = publicURL;
            fileLink.style.display = 'inline';
            fileLink.innerText = '업로드된 파일 열기';

            alert('파일 업로드 성공!');
        }
    </script>

    <!-- Bootstrap JS (optional, for interactivity) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
